<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>01: Getting Data</title>

<script src="site_libs/header-attrs-2.1/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">COVID-19-dashboard lab</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-book"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="00_setting_up_the_project.html">0. Setting COVID-19 Dashboard Project</a>
    </li>
    <li>
      <a href="01_getting_data.html">1. Getting Data</a>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">2. Interactive Plots</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="02_graphs.html">Graphs</a>
        </li>
        <li>
          <a href="03_maps.html">Maps</a>
        </li>
        <li>
          <a href="04_tables.html">Tables</a>
        </li>
      </ul>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">3. Building Shiny</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="05_shiny_basics.html">Basics</a>
        </li>
        <li>
          <a href="06_shiny_maps.html">Adding your Map</a>
        </li>
        <li>
          <a href="07_shiny_graphs.html">Adding Your Graph</a>
        </li>
        <li>
          <a href="08_shiny_tables.html">Adding Your Table</a>
        </li>
        <li>
          <a href="09_autocomplete_window.html">Auto-Complete Searchbar</a>
        </li>
      </ul>
    </li>
    <li>
      <a href="10_publish.html">4. Publish your Dashboard</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mikejohnson51/COVID-19-dashboard">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">01: Getting Data</h1>

</div>


<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<div id="tldr" class="section level2">
<h2>TL;DR</h2>
<p>This section is all about getting data for visualization. You will read “live” COVID data from the NYTimes and join the most current date to a collection of USA county centroids. if you haven’t yet installed R and RStudio - or set up your COVID-19-dashboard project - please revisit <a href="00_setting_up_the_project.html">here</a></p>
</div>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>To make our Shiny Application we first need data! In this section we are going to build <code>functions</code> to generate datasets that will be used in the application. These include:</p>
<ol style="list-style-type: decimal">
<li>A <code>county-level timeseries</code> of the most up to data COVID-19 cases and deaths</li>
<li>A spatial dataset of the <code>county centroids joined to 'todays' COVID-19 counts</code>.</li>
</ol>
</div>
<div id="streaming-covid-19-time-series-data" class="section level2">
<h2>Streaming COVID-19 time series Data</h2>
<p>The <em>New York Times</em> archives a daily record of county-level USA COVID-19 cases and deaths in a GitHub repository <a href="https://github.com/nytimes/covid-19-data">here</a>.</p>
<p>In this repository the most current, raw, CSV can be accessed at the following URL:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>url =<span class="st">&#39;https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv&#39;</span></span></code></pre></div>
<p>R is really cool, and lets read this URL directly using <code>read.csv</code> by treating the string as a connection:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Here we are reading the URL directly using the url variable created above</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>covid19 =<span class="st"> </span><span class="kw">read.csv</span>(url, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p>and look at it using the head() function to print the first few rows:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">head</span>(covid19)</span></code></pre></div>
<pre><code>##         date    county      state  fips cases
## 1 2020-01-21 Snohomish Washington 53061     1
## 2 2020-01-22 Snohomish Washington 53061     1
## 3 2020-01-23 Snohomish Washington 53061     1
## 4 2020-01-24      Cook   Illinois 17031     1
## 5 2020-01-24 Snohomish Washington 53061     1
## 6 2020-01-25    Orange California  6059     1
##   deaths
## 1      0
## 2      0
## 3      0
## 4      0
## 5      0
## 6      0</code></pre>
<p><strong>That was easy!</strong> 😄</p>
<p>Now lets look at the structure (str) of the data:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">str</span>(covid19)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    164886 obs. of  6 variables:
##  $ date  : chr  &quot;2020-01-21&quot; &quot;2020-01-22&quot; &quot;2020-01-23&quot; &quot;2020-01-24&quot; ...
##  $ county: chr  &quot;Snohomish&quot; &quot;Snohomish&quot; &quot;Snohomish&quot; &quot;Cook&quot; ...
##  $ state : chr  &quot;Washington&quot; &quot;Washington&quot; &quot;Washington&quot; &quot;Illinois&quot; ...
##  $ fips  : int  53061 53061 53061 17031 53061 6059 17031 53061 4013 6037 ...
##  $ cases : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ deaths: int  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<p>Things look pretty good but lets change our date values to <code>date</code> objects for nicer plotting.</p>
<p>We will also add a new variable called “name” which will be a text string concatenating the county and state names. Here we use the <code>dplyr</code> keyword <code>mutate</code> which allows us to create or transform variables. Since we are using <code>mutate</code> we need to attach the <code>dplyr</code> package.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a>covid19  =<span class="st"> </span>covid19 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">as.Date</span>(date), <span class="co"># Override date with formated date</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>         <span class="dt">name =</span> <span class="kw">paste0</span>(county, <span class="st">&quot; County, &quot;</span>, state)) <span class="co"># Make a new text string</span></span>
<span id="cb7-6"><a href="#cb7-6"></a></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">## Lets check!</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="kw">str</span>(covid19)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    164886 obs. of  7 variables:
##  $ date  : Date, format:  ...
##  $ county: chr  &quot;Snohomish&quot; &quot;Snohomish&quot; &quot;Snohomish&quot; &quot;Cook&quot; ...
##  $ state : chr  &quot;Washington&quot; &quot;Washington&quot; &quot;Washington&quot; &quot;Illinois&quot; ...
##  $ fips  : int  53061 53061 53061 17031 53061 6059 17031 53061 4013 6037 ...
##  $ cases : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ deaths: int  0 0 0 0 0 0 0 0 0 0 ...
##  $ name  : chr  &quot;Snohomish County, Washington&quot; &quot;Snohomish County, Washington&quot; &quot;Snohomish County, Washington&quot; &quot;Cook County, Illinois&quot; ...</code></pre>
<p>Great! Now we see <code>date</code> is in fact a <code>date</code> object, and <code>name</code> gives us the combined state-county name.</p>
<p>Now lets us see how the data works using LA County (FIP = 6037) as an example. Here we use the <code>dplyr</code> <code>filter</code> keyword to return rows matching a prescribed condition. Since <code>dplyr</code> was already attached above, we do not need to re-attach the package. This is also a good time to introduce that R lets you access any column of a data.frame using the <code>$</code>. For example, <code>covid19$date</code> would return all dates in our <code>covid19</code> data.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Filter the covid19 data to only those records were fips equals 6037</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>test =<span class="st"> </span><span class="kw">filter</span>(covid19, fips <span class="op">==</span><span class="st"> </span><span class="dv">6037</span>)</span>
<span id="cb9-3"><a href="#cb9-3"></a></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co"># Plot the data</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="kw">plot</span>(<span class="dt">x =</span> test<span class="op">$</span>date, <span class="co"># define the x axis variable using all the dates in test</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>     <span class="dt">y =</span> test<span class="op">$</span>cases, <span class="co"># define the y axis variable</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>     <span class="dt">type  =</span> <span class="st">&quot;l&quot;</span>, <span class="co"># we wnat a line &quot;l&quot; plot</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Date&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Cases&quot;</span>, <span class="co"># refine the x and y labels</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>     <span class="dt">main =</span> test<span class="op">$</span>name[<span class="dv">1</span>]) <span class="co"># define the plot title.</span></span></code></pre></div>
<p><img src="01_getting_data_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Yikes LA! That is quite a curve….</p>
<div id="getting-spatial-data-for-the-counties" class="section level3">
<h3>Getting Spatial Data for the Counties:</h3>
<p>There are many ways to get spatial data into R. I have saved the USA low-resolution county geometries <a href="https://github.com/mikejohnson51/COVID-19-dashboard/blob/master/data/counties.rds">here</a> for you to download. Please do so and save it into the <code>data folder</code> folder you created.</p>
<p>Next, we will attach the <code>sf</code> library, read the downloaded RDS file, and plot the geometry attribute of the data!</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">library</span>(sf) <span class="co"># Attach sf library</span></span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a>counties =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;./data/counties.rds&quot;</span>) <span class="co"># read rds data using the path to your resource</span></span>
<span id="cb10-4"><a href="#cb10-4"></a></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="kw">plot</span>(counties<span class="op">$</span>geometry) <span class="co"># plot the county geometries</span></span></code></pre></div>
<p><img src="01_getting_data_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="getting-county-centroids-and-joining-to-covid-data" class="section level3">
<h3>Getting county centroids and joining to COVID data</h3>
<p>Great! Now we have a spatial representation of all continental USA counties and a time series of COVID-19 cases and deaths. Lets create a new dataset that joins the most recent daily statistics to the spatial geometries For faster rendering, we will convert the county polygons into centroids using the following steps:</p>
<ol style="list-style-type: decimal">
<li><code>Filter</code> our <code>covid19_data</code> to the the most current (maximum) date</li>
<li><code>Join</code> it to the counties using the same-named <code>fips</code> variable,</li>
<li>Remove NA values</li>
<li>scale the cases to determine a standardized case count.</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>today =<span class="st"> </span><span class="kw">filter</span>(covid19, date <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(date)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># filter all data to the maximum datae</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="st">  </span><span class="kw">left_join</span>(<span class="kw">st_centroid</span>(counties), <span class="dt">by =</span> <span class="st">&#39;fips&#39;</span>) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># cast county geometries to centroid, and join by fip</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="st">  </span><span class="kw">na.omit</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># remove NA values</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">size =</span> <span class="kw">abs</span>(cases <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(cases)) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(cases)) <span class="co"># Compute a scaled case count</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>  </span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co"># Plot and size (cex) the cnetroid data</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="kw">plot</span>(today<span class="op">$</span>geometry, <span class="dt">cex =</span> today<span class="op">$</span>size)</span></code></pre></div>
<p><img src="01_getting_data_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>I know that was a lot, if you understood what was going on in the code great! If you didn’t, that is totally OK too (it just means you haven’t had as much programming experience).</p>
</div>
</div>
<div id="adding-data-functions-to-helpers.r" class="section level2">
<h2>Adding Data Functions to <code>helpers.R</code></h2>
<p>Now lets turn the above processes into <code>functions</code> that we can save to our <code>helpers.R</code> file and latter use in our Shiny Application.</p>
<p>You can either type them in or use the copy icon to put these in your <code>helpers.R</code> file</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co">#Load Spatial Data</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>counties =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;./data/counties.rds&quot;</span>)</span>
<span id="cb12-3"><a href="#cb12-3"></a></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co"># Read in COVID-19 Timesries from URL</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>read_covid19 =<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb12-6"><a href="#cb12-6"></a>  url =<span class="st"> &#39;https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv&#39;</span></span>
<span id="cb12-7"><a href="#cb12-7"></a>  <span class="kw">read.csv</span>(url, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">as.Date</span>(date), </span>
<span id="cb12-9"><a href="#cb12-9"></a>           <span class="dt">fips =</span> <span class="kw">as.numeric</span>(fips), </span>
<span id="cb12-10"><a href="#cb12-10"></a>           <span class="dt">name =</span> <span class="kw">paste0</span>(county, <span class="st">&quot; County, &quot;</span>, state))</span>
<span id="cb12-11"><a href="#cb12-11"></a>}</span>
<span id="cb12-12"><a href="#cb12-12"></a></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="co"># Join County Data with </span></span>
<span id="cb12-14"><a href="#cb12-14"></a>today_centroids =<span class="st"> </span><span class="cf">function</span>(counties, covid_data){</span>
<span id="cb12-15"><a href="#cb12-15"></a>  <span class="kw">filter</span>(covid_data, date <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(date)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-16"><a href="#cb12-16"></a><span class="st">    </span><span class="kw">left_join</span>(<span class="kw">st_centroid</span>(counties), <span class="dt">by =</span> <span class="st">&#39;fips&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-17"><a href="#cb12-17"></a><span class="st">    </span><span class="kw">na.omit</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-18"><a href="#cb12-18"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">size =</span> <span class="kw">abs</span>(cases <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(cases)) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(cases)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-19"><a href="#cb12-19"></a><span class="st">    </span><span class="kw">st_as_sf</span>()</span>
<span id="cb12-20"><a href="#cb12-20"></a>}</span></code></pre></div>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>Fantastic, now we have methods and data needed to build our Shiny App, and we have useful functions to let us manipulate that data. If you feel lost, again, it is not a problem! Lets move to the next <a href="02_graphs.html">section</a> where we will make interactive graphs of our time series data using the <code>dygraphs</code> package and we will start to see things coming together</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
