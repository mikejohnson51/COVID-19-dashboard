<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Mike Johnson" />


<title>04_Adding_the_Map</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">COVID-19 Dashboard</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-book"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="00_setting_up_the_project.html">Setting COVID-19 Dashboard Project</a>
    </li>
    <li>
      <a href="01_getting_data.html">Getting Data</a>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Interactive Plots</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="02_graphs.html">Graphs</a>
        </li>
        <li>
          <a href="03_maps.html">Maps</a>
        </li>
        <li>
          <a href="04_tables.html">Tables</a>
        </li>
      </ul>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Building Shiny</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="05_shiny_basics.html">Basics</a>
        </li>
        <li>
          <a href="06_shiny_maps.html">Adding your Map</a>
        </li>
        <li>
          <a href="07_shiny_graph.html">Adding Your Graph</a>
        </li>
        <li>
          <a href="08_shiny_table.html">Adding Your Table</a>
        </li>
        <li>
          <a href="09_autocomplete.html">Auto-Complete Searchbar</a>
        </li>
      </ul>
    </li>
    <li>
      <a href="10_publish.html">Publish your Dashboard</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">04_Adding_the_Map</h1>
<h4 class="author">Mike Johnson</h4>
<h4 class="date">4/3/2020</h4>

</div>


<div id="starting-the-ui" class="section level2">
<h2>Starting the UI</h2>
<p>We save all of this code, the ui object, the server function, and the call to the shinyApp() function, in an R script called app.R. This is the same basic structure for all Shiny applications.</p>
<p>Here we are creatining a fluid page.</p>
<p>Here is the user interface object for our COVID-19-dashboard application. Notice that within the fluidPage we’ve added a sidebarPanel and mainPanel function to define how space on the page is distributed.</p>
<p>In the sidebarPanel we are going to display textOutput. We call the object it will display “covid_message”. Here the container fuction generates an HTML element to contain the text. Here the size of this text is defined by the ‘h3’ tag.</p>
<p>In the mainPanel, we are going to render a leaflet map. Here it will display the obput object called “covid_map” that must be rendered in the server function. We also define a appliation title in the mainPanel that is stored in a titlePanel.</p>
<pre class="r"><code>ui &lt;- fluidPage(

  # Sidebar layout output definitions ----
  sidebarPanel(
    # Output: Message ----
    textOutput(&quot;covid_message&quot;, container = h3)
  ),

  # Main panel for displaying outputs ----
  mainPanel(
    # App title ----
    titlePanel(&#39;Mike Johnson: COVID-19 Tracker&#39;),
    # Output: Map ----
    leafletOutput(&#39;covid_map&#39;)
  )
)</code></pre>
</div>
<div id="initialize-the-server-function" class="section level2">
<h2>Initialize the server function</h2>
<p>The UI object, only defines how to lay out objects that are passed from a server function or defined by HTML.</p>
<p>Lets set up our server function to define the “covid_message” and “covid_map” that the UI will display. Below we set the foundations for our server function.</p>
<p>First we must define a intiatl reativeValue to store the “covid_message”. Next we create the covid_map as</p>
<pre class="r"><code>server &lt;- function(input, output, session) {
  
  # Global variables initialized ----
  v   &lt;- reactiveValues(msg = &quot; First Shiny!!! &quot;)
  # Leaflet Map ----
  # ---- must be rendered as leaflet ----
  output$covid_map     &lt;- renderLeaflet({ leaf_map })
  # Message to Display ----
  # ---- must be rendered as text ----
  output$covid_message &lt;- renderText(v$msg)
}</code></pre>
</div>
<div id="run-the-app" class="section level2">
<h2>Run the App:</h2>
<pre class="r"><code>runApp(shinyApp(ui, server), launch.browser = TRUE)</code></pre>
<p><img src="figures/first_app.png" /></p>
</div>
<div id="engaging-a-mouse-observer" class="section level2">
<h2>Engaging a Mouse Observer</h2>
<p>Here we want to observe what the mouse is doing in the UI and pass information from the cursor back to the server function. Part of the reactivity of Shiny allows the server to “listen” or “observe” what the mouse is doing.</p>
<p>Lets start by observing an event - namely the mouse cursors interactions with the covid_map object. What we want to do is observe the map marker underneath the mouse. To do this we observe an event (observeEvent) in the “input”. The object we want to observer is the covid_map, and more specifically, the covid_map_marker. Fianlly, we can add on the mouseover call.</p>
<p>So in the observer we are observing the covid_map_marker_mouseover, at anytime we can extract the id of the marker from the covid_map_marker_mouseover. Remember that hte marker ID was defined as the FIPS code in our base_map() function (see layerID = ~fips). We use this id/FIPS code to subset the ‘today’ dataset and extract the prettified call we added:</p>
<p>We then change the reactive message in the v$msg to tell us the county/state pair the mouse is over, which will be rendered as text in the server function, and then passed to the UI to display.</p>
<pre class="r"><code># Add this to the server function
observeEvent(input$covid_map_marker_mouseover, {
    # Filter the &#39;today&#39; data to only records were the FIP == mouseover marker ID
    txt = filter(today, fips == input$covid_map_marker_mouseover$id)
    # Update the reative message variable
    v$msg &lt;- paste(&quot;Mouse is over: &quot;, txt$call)
  })</code></pre>
<p>But what happens when the mouse leaves the marker? Do we want the message to stay? Certainly not! So, lets add anthor listener with the</p>
<p># So what happen once our mouse moves away from a marker? Well, we listen for that by observing the event of # the MOUSE, moving OUT (mouseout), of a MARKER, on a MAP object shown in the UI. # When this happens we change the reactive map message which is then shown in the UI</p>
<pre class="r"><code>observeEvent(input$covid_map_marker_mouseout, { v$msg &lt;- &quot;Mouse is over: &quot; })</code></pre>
<p>With those two new observers in you server function, lets once again run our Shiny App by recalling:</p>
<pre class="r"><code>runApp(shinyApp(ui, server), launch.browser = TRUE)</code></pre>
<p><img src="figures/second_app.png" /></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
